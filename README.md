# ‚öõÔ∏è Science Memes: Meme Template Recognition (Report Section 3)
This repository contains the code and analysis for Section 3: Meme Template Recognition of a larger multi-modal analysis project on science memes on Reddit. The overarching project aims to understand how scientific concepts are communicated, potentially misconstrued, and diffused through digital memes by analyzing their visual, textual, and social characteristics.

This notebook (Science_Memes_Meme_Template_Recognition.ipynb) specifically implements the methodology for identifying meme templates, utilizing a hybrid approach combining supervised image classification and advanced multimodal large language models. The output of this template recognition feeds into the broader project's objectives, particularly for correlating visual formats with thematic framings and social diffusion patterns.
___
## üåü What This Notebook Does (Section 3 Contribution)
Automated Meme Template Dataset Creation: Gathers diverse meme template images from Google Search (via SerpAPI) to create a clean, labeled dataset for supervised classifier training.
Supervised Template Classifier Training: Trains and evaluates a ResNet18 convolutional neural network (CNN) on the collected meme template images. This model aims to identify popular, pre-defined meme formats.
Includes data augmentation for robustness and an experimental grayscale model.
Evaluates model performance on both training and test sets.
Hybrid Template Recognition Pipeline:
Applies the trained ResNet18 classifier to the main science meme dataset.
Implements a confidence threshold: memes classified with low confidence are forwarded to an advanced LLM.
Leverages Google Gemini 1.5 Flash Multimodal LLM: For memes where the CNN classifier is uncertain or identifies "noise" (e.g., plain text, unknown templates, unusual layouts), Gemini 1.5 Flash is used. It processes the image with a carefully engineered prompt to identify and name the visual meme template, handling complex visual cues and text within images.
Intelligent Label Normalization: Implements a rule-based system to consolidate similar template names generated by Gemini (e.g., "drakeposting" and "drake format" map to "drake meme") to reduce label sparsity.
Analysis and Visualization of Template Usage:
Identifies and visualizes the most frequently used meme templates across the entire dataset.
Analyzes template diversity per meme category (labels from other report sections).
Performs a Chi-Squared test to statistically assess correlations between identified meme templates and the pre-existing thematic/sentiment labels of the broader project.
## üìù Overall Project Context (Other Report Sections)

This notebook's work is a foundational component of a larger project that also involves:

- Report Section 1: Social Content Analysis
Text Extraction (OCR): Performed initial OCR on meme images (e.g., with PyTesseract and PaddleOCR) to extract meme text, which was later enhanced by Gemini's multimodal capabilities as part of Section 3's template recognition.
Clustering and Label Assignment: Memes were grouped into thematic clusters like "Conspiracy," "Educational Science Humor," and "Wordplay & Nerd Humor" based on textual content embeddings (using all-roberta-large-v1 and fine-tuned all-mpnet-base-v2).
Sentiment & Emotion Analysis: Applied VADER and a transformer-based emotion classifier (augmented with sarcasm detection) to assign sentiment and emotion scores to memes.
- Report Section 2: Social Network Analysis
Author-Commenter Graph Construction: Built a network of Reddit users based on meme authorship and commenting interactions.
Community Detection: Applied Louvain and FluidC algorithms to identify distinct user communities within the network.
Centrality Measures: Calculated degree, betweenness, and closeness centrality to identify influential users and understand information flow.
The template recognition data generated in this notebook serves as a crucial visual feature for integrating with the thematic and social network analyses performed in other sections of the report.

## üõ†Ô∏è Technologies Used (Specific to this Notebook)
Python 3.x
Data Handling: pandas, json, os
Image Processing: PIL (Pillow), ImageChops
API Interaction: google-generativeai, serpapi, requests, urllib.parse
Progress Tracking: tqdm (for notebook-friendly progress bars)
Machine Learning (Image Classifier): torch, torch.nn, torch.optim, torchvision (models, datasets, transforms)
Statistical Analysis: scipy.stats (chi2_contingency)
Visualization: matplotlib.pyplot, seaborn
‚öôÔ∏è Setup and Installation
- Clone the Repository:

git clone https://github.com/your-username/science-memes-analysis.git
cd science-memes-analysis
- Create a Virtual Environment (Recommended):

`python -m venv venv`
`source venv/bin/activate` On Windows, use `venv\Scripts\activate`
- Install Dependencies:
`pip install -q google-generativeai Pillow pandas tqdm google-search-results requests torch torchvision scikit-learn scipy matplotlib seaborn`

###¬†Set Up API Keys:
This project requires API keys for:
- Google Generative AI (Gemini): For advanced OCR and meme template classification.
Get your API key from Google AI Studio.
Set it as an environment variable: export GOOGLE_API_KEY="YOUR_GEMINI_API_KEY"
- SerpAPI: For collecting a diverse dataset of meme templates for classifier training.
Get your API key from SerpAPI.
Set it as an environment variable: export SERPAPI_API_KEY="YOUR_SERPAPI_KEY"
Important: Replace "YOUR_SERPAPI_KEY" and "YOUR_GOOGLE_API_KEY" placeholders in the notebook. 
___
- For security, never commit your API keys directly to Git.
___
###¬†Prepare Data Directories (Crucial for this Notebook):
- The notebook uses hardcoded paths that you will need to adapt to your environment. Specifically:
- output_dir (for downloaded templates): This is where images for training the ResNet18 classifier will be saved. Update the path in the download_images_for_template function.
- dataset_path (for classifier training): This should point to the output_dir once the template images are downloaded.
- image_dir (for the main meme dataset): This is the directory containing the actual science meme images (.jpg, .png, etc.) that will be classified. You'll need to provide these images yourself as they are not collected by this notebook.
- meme_df.csv: This is the input DataFrame containing metadata about the main science memes, including their post_id. This DataFrame is expected to be pre-generated by upstream processes of the larger project.
- cache.json and results_path: Paths for caching Gemini and classifier results.
/path/to/test/image.jpg: Update this for the Gemini test call.
- final_df.csv & meme_df_with_templates.csv: Output paths for the enhanced DataFrames.

### üèÉ‚Äç‚ôÄÔ∏è Usage
Open the Jupyter Notebook:
`jupyter notebook Science_Memes_Meme_Template_Recognition.ipynb`
Execute Cells: Run the cells sequentially.
- Dataset Creation: The code will first download a dataset of meme templates using your SerpAPI key. This is a crucial step for training the image classifier.
Classifier Training: The ResNet18 model will then be trained on these downloaded template images.
- Template Classification: The notebook proceeds to classify the images in your image_dir using the trained classifier and the Gemini API. This step might take a considerable amount of time due to API calls and image processing.
- Analysis and Visualisation: The final sections will generate plots and statistical tests based on the meme template recognition results, correlating them with the final_label column (which is assumed to be present in your meme_df.csv and final_df.csv from prior analysis).
___
### ü§ù Contributing
Contributions are welcome! If you have suggestions for improvements, new analysis techniques, or bug fixes specific to meme template recognition, please open an issue or submit a pull request.

## Authors:

<div align="center"> <table> <tr> <td align="center"> <a href="https://github.com/M4tteoo"> <img src="https://github.com/M4tteoo.png" width="100px;" alt="Matteo Salami"/><br /> <sub><b>Matteo Salami</b></sub> </a> </td> <td align="center"> <a href="https://github.com/ashley-andrea"> <img src="https://github.com/ashley-andrea.png" width="100px;" alt="Ashley Andrea Squarcio"/><br /> <sub><b>ashley-andrea</b></sub> </a> </td> <td align="center"> <a href="https://github.com/PietroSaveri"> <img src="https://github.com/PietroSaveri.png" width="100px;" alt="Pietro Saveri"/><br <sub><b>pietrosaveri</b></sub> </a> </td> </tr>  </table> </div>
